<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Export html table to excel and csv using jquery</title>
    <script src="media/js/jquery.js"></script>
    <link rel="stylesheet" href="media/css/bootstrap.min.css">
    <script type="text/javascript" src="media/js/toExcel/jquery.base64.js"></script>

    <script type="text/javascript" src="media/js/toExcel/tableExport.js"></script>

    <script type="text/javascript" src="media/js/toExcel/jspdf/libs/sprintf.js">
    </script>

    <script type="text/javascript"
            src="media/js/toExcel/jspdf/jspdf.js"></script>
    <script type="text/javascript" src="media/js/toExcel/jspdf/libs/base64.js"></script>

</head>
<body>
[align=right]
<br><br><br>
<button class="btn btn-success" onClick="$('#customers').tableExport({type: 'excel', escape: 'false'});">Excel Export
</button>
<button class="btn btn-success" onClick="$('#customers').tableExport({type: 'pdf', escape: 'false'});">CSV Export
</button>
<br><br>
[/align]
<table id="customer" class="table table-striped table-bordered">
    <thead>
    <tr class='warning'>
        <th>Country</th>
        <th>Population</th>
        <th>Date</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td>Chinna</td>
        <td>2233</td>
        <td>March 24, 2014</td>
    </tr>
    <tr>
        <td>India</td>
        <td>1,241,900,000</td>
        <td>March 24, 2014</td>
    </tr>
    <tr>
        <td>United States</td>
        <td>317,746,000</td>
        <td>March 24, 2014</td>
    </tr>
    <tr>
        <td>Indonesia</td>
        <td>24933</td>
        <td>July 1, 2013</td>
    </tr>
    <tr>
        <td>Brazil</td>
        <td>3333</td>
        <td>July 1, 2013</td>
    </tr>
    </tbody>
</table>
</div>
<div class="demo">
    <table id="customers" value="wyw" width="100%" class="table">
        <thead>
        <tr>
            <th>&nbsp;<input id="checkAll" type="checkbox" class="checkboxCtrl" onclick="checkAll()"/></th>
            <!-- »´—° -->
            <th width="15%"><b>Organism Name</b></th>
            <th width="5%"><b>Genome Accession</b></th>
            <th width="30%"><b>description</b></th>
            <th width="4%"><b>Genome Status</b></th>
            <th><b>project</b></th>
            <th width="10%"><b>bioproject</b></th>
            <th width="5%"><b>strain</b></th>
            <th><b>Genome browser</b></th>
        </tr>
        <li class=""><a class="btn btn-success" onclick="getXlsFromTbl('customers',null)"><span>导出EXCEL</span></a></li>
        </thead>
        <tbody id="taxonomy">
        <tr>
            <td><input type="checkbox" name="preCheck" id="row1"></td>
            <td>Chinna</td>
            <td>13333</td>
            <td>March 24, 2014</td>
            <td>Chinna</td>
            <td>140</td>
            <td>March 24, 2014</td>
            <td>Chinna</td>
            <td>121</td>
        </tr>
        <tr>
            <td><input type="checkbox" name="preCheck" id="row2"></td>
            <td>Chinna</td>
            <td>244</td>
            <td>March 24,2014</td>
            <td>Chinna</td>
            <td>4445</td>
            <td>March 24, 2014</td>
            <td>Chinna</td>
            <td>44.03</td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>
<script type="text/javascript">
    function isIE() { //ie?
        if (!!window.ActiveXObject || "ActiveXObject" in window)
            return true;
        else
            return false;
    }

    function getXlsFromTbl(inTblId, inWindow) {
//        alert($("input[name='preCheck']:checked").length);

        //选取的行
        if ($("input[name='preCheck']:checked").length > 0) {

            try {
                var allStr = "";
                var curStr = "";
                var fileName = getExcelFileName();
                //                var cc = document.all;
                //                var ccc = typeof (document.all)
                //                alert(cc)
                //                alert(ccc)
                if (inTblId != null && inTblId != "" && inTblId != "null") {
                    var hh = isIE();
                    if (hh == true) //IE浏览器
                    {
                        curStr = getTblData(inTblId, inWindow);
                        if (curStr != null) {
                            allStr += curStr;
                        }
                        else {
                            alert("你要导出的表不存在");
                            return;
                        }
                        doFileExport(fileName, allStr);
                    } else {
                        curStr = getTblData1(inTblId, inWindow);
                        if (curStr != null) {
                            allStr += curStr;
                        }
                        else {
                            alert("你要导出的表不存在");
                            return;
                        }
                        var uri = 'data:text/xls;charset=utf-8,\ufeff' + encodeURIComponent(allStr);
                        //创建a标签模拟点击下载
                        var downloadLink = document.createElement("a");
                        downloadLink.href = uri;
                        downloadLink.download = fileName;
                        document.body.appendChild(downloadLink);
                        downloadLink.click();
                        document.body.removeChild(downloadLink);
                    }
                }
            }
            catch (e) {
                alert("导出发生异常:" + e.name + "->" + e.description + "!");
            }
        } else {
            alert("请选择要导出的数据!");

        }
    }

    function getTblData(inTbl, inWindow) {
        var rows = 0;
        var tblDocument = document;
        if (!!inWindow && inWindow != "") {

            if (!document.all(inWindow)) {
                return null;
            }
            else {
                tblDocument = eval(inWindow).document;
            }
        }

        var curTbl = tblDocument.getElementById(inTbl);
        var outStr = "";

        if (curTbl != null) {

            for (var j = 0; j < curTbl.rows.length; j++) {
                if (j == 0) {
                    for (var i = 1; i < curTbl.rows[0].cells.length; i++) {
//
//                        if (i == 0 && rows > 0) {
//                            outStr += "\t";//\t
//                            rows -= 1;
//                        }
                        var s = curTbl.rows[0].cells[i].innerText;
                        s = s.replace(",", "");

                        outStr += s + "\t";//\t

                        if (curTbl.rows[j].cells[i].colSpan > 1) {
                            for (var k = 0; k < curTbl.rows[j].cells[i].colSpan - 1; k++) {
                                outStr += "\t";//\t
                            }
                        }
//                        if (i == 0) {
//                            if (rows == 0 && curTbl.rows[j].cells[i].rowSpan > 1) {
//                                rows = curTbl.rows[j].cells[i].rowSpan - 1;
//                            }
//                        }
                    }
                    outStr += "\r\n";
                }
                if (($("#row" + (j+1) + "").prop('checked') == true)) {
                    for (var i = 1; i < curTbl.rows[j].cells.length; i++) {

//
//                        if (i == 0 && rows > 0) {
//                            outStr += "\t";//\t
//                            rows -= 1;
//                        }
                        var s = curTbl.rows[j + 1].cells[i].innerText;
                        s = s.replace(",", "");

                        outStr += s + "\t";//\t

                        if (curTbl.rows[j].cells[i].colSpan > 1) {
                            for (var k = 0; k < curTbl.rows[j].cells[i].colSpan - 1; k++) {
                                outStr += "\t";//\t
                            }
                        }
//                        if (i == 0) {
//                            if (rows == 0 && curTbl.rows[j].cells[i].rowSpan > 1) {
//                                rows = curTbl.rows[j].cells[i].rowSpan - 1;
//                            }
//                        }
                    }//

                    outStr += "\r\n";
                }
            }

        }

        else {
            outStr = null;
            alert(inTbl + "不存在 !");
        }
        return outStr;
    }


    function getTblData1(inTbl, inWindow) {
        var rows = 0;
        var tblDocument = document;
        if (!!inWindow && inWindow != "") {
            if (!document.all(inWindow)) {//用对象id来引用一个特定的对象
                return null;
            }
            else {
                tblDocument = eval(inWindow).document;
            }
        }

        //当前的table
        var curTbl = tblDocument.getElementById(inTbl);
        var outStr = "";

        if (curTbl != null) {

            for (var j = 0; j < curTbl.rows.length; j++) {
                if (j == 0) {
                    for (var i = 1; i < curTbl.rows[0].cells.length; i++) {
//                        if (i == 0 && rows > 0) {
//                            outStr += ",";//\t
//                            rows -= 1;
//                        }
                        var s = curTbl.rows[0].cells[i].innerText;
                        s = s.replace(",", " ");

                        outStr += s + ",";//\t

                        if (curTbl.rows[j].cells[i].colSpan > 1) {
                            for (var k = 0; k < curTbl.rows[j].cells[i].colSpan - 1; k++) {
                                outStr += ",";//\t
                            }
                        }
//                        if (i == 0) {
//                            if (rows == 0 && curTbl.rows[j].cells[i].rowSpan > 1) {
//                                rows = curTbl.rows[j].cells[i].rowSpan - 1;
//                            }
//                        }
                    }
                    outStr += "\r\n";
                }

                if (($("#row"+(j+1)).prop('checked') == true)) {
                    for (var i = 1; i < curTbl.rows[j].cells.length; i++) {
//                        if (i == 0 && rows > 0) {
//                            outStr += ",";//\t
//                            rows -= 1;
//                        }
                        var s = curTbl.rows[j + 1].cells[i].innerText;
                        s = s.replace(",", " ");

                        outStr += s + ",";//\t

                        if (curTbl.rows[j].cells[i].colSpan > 1) {
                            for (var k = 0; k < curTbl.rows[j].cells[i].colSpan - 1; k++) {
                                outStr += ",";//\t
                            }
                        }
//                        if (i == 0) {
//                            if (rows == 0 && curTbl.rows[j].cells[i].rowSpan > 1) {
//                                rows = curTbl.rows[j].cells[i].rowSpan - 1;
//                            }
//                        }
                    }
                    outStr += "\r\n";
                }
            }
        }

        else {
            outStr = null;
            alert(inTbl + "不存在 !");
        }
        return outStr;
    }
    function getExcelFileName() {
        var d = new Date();
        var curYear = d.getYear();
        var curMonth = "" + (d.getMonth() + 1);
        var curDate = "" + d.getDate();
        var curHour = "" + d.getHours();
        var curMinute = "" + d.getMinutes();
        var curSecond = "" + d.getSeconds();
        if (curMonth.length == 1) {
            curMonth = "0" + curMonth;
        }

        if (curDate.length == 1) {
            curDate = "0" + curDate;
        }

        if (curHour.length == 1) {
            curHour = "0" + curHour;
        }

        if (curMinute.length == 1) {
            curMinute = "0" + curMinute;
        }

        if (curSecond.length == 1) {
            curSecond = "0" + curSecond;
        }
        var fileName = "table" + "_" + curYear + curMonth + curDate + "_"
                + curHour + curMinute + curSecond + ".csv";
        return fileName;
    }

    function doFileExport(inName, inStr) {
        var xlsWin = null;
        if (!!document.all("glbHideFrm")) {
            xlsWin = glbHideFrm;
        }
        else {
            var width = 6;
            var height = 4;
            var openPara = "left=" + (window.screen.width / 2 - width / 2)
                    + ",top=" + (window.screen.height / 2 - height / 2)
                    + ",scrollbars=no,width=" + width + ",height=" + height;
            xlsWin = window.open("", "_blank", openPara);
        }
        xlsWin.document.write(inStr);
        xlsWin.document.close();
        xlsWin.document.execCommand('Saveas', true, inName);
        xlsWin.close();

    }
    function checkAll() {
        var allCheckBoxs = document.getElementsByName('preCheck');
        var desc = document.getElementById("allChecked");
        var selectOrUnselect = false;
        for (var i = 0; i < allCheckBoxs.length; i++) {
            if (allCheckBoxs[i].checked) {
                selectOrUnselect = true;
                break;
            }
        }
        if (selectOrUnselect) {
            _allUnchecked(allCheckBoxs);
        } else {
            _allchecked(allCheckBoxs);
        }
    }
    function _allchecked(allCheckBoxs) {
        for (var i = 0; i < allCheckBoxs.length; i++) {
            allCheckBoxs[i].checked = true;
        }
    }
    function _allUnchecked(allCheckBoxs) {
        for (var i = 0; i < allCheckBoxs.length; i++) {
            allCheckBoxs[i].checked = false;
        }
    }


</script>

