<!DOCTYPE html>
<!--[if IE 8]>
<html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en" class="no-js"> <!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8"/>
    <title>司机排班 | 厂车管理系统</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="" name="description"/>
    <meta content="" name="author"/>
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="media/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/style-metro.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/style.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/style-responsive.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/default.css" rel="stylesheet" type="text/css" id="style_color"/>
    <link href="media/css/uniform.default.css" rel="stylesheet" type="text/css"/>
    <!-- END GLOBAL MANDATORY STYLES -->
    <link rel='stylesheet' type='text/css' href='media/css/jquery-ui-1.8.11.custom.css'/>
    <!-- END GLOBAL MANDATORY STYLES -->
    <link rel="stylesheet" href="media/css/DT_bootstrap.css">
    <link rel="stylesheet" type="text/css" href="media/css/select2_metro.css"/>
    <link href="media/css/mystyle.css" rel="stylesheet" type="text/css"/>
</head>
<!-- END HEAD -->

<!-- BEGIN BODY -->
<body class="page-header-fixed page-full-width">
<!-- BEGIN HEADER -->
<div class="header navbar navbar-inverse navbar-fixed-top">

    <!-- BEGIN TOP NAVIGATION BAR -->

    <div class="navbar-inner">

        <div class="container-fluid">

            <!-- BEGIN LOGO -->
            <a class="brand" href="index.html">
                <img src="media/image/logo.png" alt="logo">
            </a>
            <!-- END LOGO -->
            <!-- BEGIN HORIZANTAL MENU -->
            <div class="navbar hor-menu hidden-phone hidden-tablet">
                <div class="navbar-inner">
                    <ul class="nav">
                        <li>
                            <a href="index.html">
                                首页
                            </a>
                        </li>

                        <li class="active">

                            <a data-toggle="dropdown" class="dropdown-toggle" href="javascript:;">

                                <span class="selected"></span>

                                Layouts

                                <span class="arrow"></span>

                            </a>

                            <ul class="dropdown-menu">

                                <li>

                                    <a href="layout_horizontal_sidebar_menu.html">

                                        Horzontal &amp; Sidebar Menu </a>

                                </li>

                                <li class="active">

                                    <a href="layout_horizontal_menu1.html">

                                        Horzontal Menu 1 </a>

                                </li>

                                <li>

                                    <a href="layout_horizontal_menu2.html">

                                        Horzontal Menu 2 </a>

                                </li>

                                <li>

                                    <a href="layout_promo.html">

                                        Promo Page </a>

                                </li>

                                <li>

                                    <a href="layout_email.html">

                                        Email Templates </a>

                                </li>

                                <li>

                                    <a href="layout_ajax.html">

                                        Content Loading via Ajax</a>

                                </li>

                                <li>

                                    <a href="layout_sidebar_closed.html">

                                        Sidebar Closed Page </a>

                                </li>

                                <li>

                                    <a href="layout_blank_page.html">

                                        Blank Page </a>

                                </li>

                                <li>

                                    <a href="layout_boxed_page.html">Boxed Page</a>

                                </li>

                                <li>

                                    <a href="layout_boxed_not_responsive.html">

                                        Non-Responsive Boxed Layout </a>

                                </li>

                                <li class="dropdown-submenu">

                                    <a href="javascript:;">

                                        More options

                                        <span class="arrow"></span>

                                    </a>

                                    <ul class="dropdown-menu">

                                        <li><a href="#">Second level link</a></li>

                                        <li class="dropdown-submenu">

                                            <a href="javascript:;">More options<span class="arrow"></span></a>

                                            <ul class="dropdown-menu">

                                                <li><a href="index.html">Third level link</a></li>

                                                <li><a href="index.html">Third level link</a></li>

                                                <li><a href="index.html">Third level link</a></li>

                                                <li><a href="index.html">Third level link</a></li>

                                                <li><a href="index.html">Third level link</a></li>

                                            </ul>

                                        </li>

                                        <li><a href="index.html">Second level link</a></li>

                                        <li><a href="index.html">Second level link</a></li>

                                        <li><a href="index.html">Second level link</a></li>

                                    </ul>

                                </li>

                            </ul>

                            <b class="caret-out"></b>

                        </li>

                        <li>

                            <a href="">Tables</a>

                        </li>

                        <li class="">

                            <a data-toggle="dropdown" class="dropdown-toggle" href="">Extra

                                <span class="arrow"></span>

                            </a>

                            <ul class="dropdown-menu">

                                <li><a href="index.html">About Us</a></li>

                                <li><a href="index.html">Services</a></li>

                                <li><a href="index.html">Pricing</a></li>

                                <li><a href="index.html">FAQs</a></li>

                                <li><a href="index.html">Gallery</a></li>

                                <li><a href="index.html">Registration</a></li>

                                <li><a href="index.html">2 Columns (Left)</a></li>

                                <li><a href="index.html">2 Columns (Right)</a></li>

                            </ul>

                            <b class="caret-out"></b>

                        </li>

                        <li>

                            <span class="hor-menu-search-form-toggler">&nbsp;</span>

                            <div class="search-form hidden-phone hidden-tablet">

                                <form class="form-search">

                                    <div class="input-append">

                                        <input type="text" placeholder="Search..." class="m-wrap">

                                        <button type="button" class="btn"></button>

                                    </div>

                                </form>

                            </div>

                        </li>

                    </ul>

                </div>

            </div>

            <!-- END HORIZANTAL MENU -->

            <!-- BEGIN TOP NAVIGATION MENU -->

            <ul class="nav pull-right">

                <!-- BEGIN NOTIFICATION DROPDOWN -->

                <li class="dropdown" id="header_notification_bar">

                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">

                        <i class="icon-warning-sign"></i>

                        <span class="badge">6</span>

                    </a>

                    <ul class="dropdown-menu extended notification">

                        <li>

                            <p>You have 14 new notifications</p>

                        </li>

                        <li>

                            <a href="#">

                                <span class="label label-success"><i class="icon-plus"></i></span>

                                New user registered.

                                <span class="time">Just now</span>

                            </a>

                        </li>

                        <li>

                            <a href="#">

                                <span class="label label-important"><i class="icon-bolt"></i></span>

                                Server #12 overloaded.

                                <span class="time">15 mins</span>

                            </a>

                        </li>

                        <li>

                            <a href="#">

                                <span class="label label-warning"><i class="icon-bell"></i></span>

                                Server #2 not respoding.

                                <span class="time">22 mins</span>

                            </a>

                        </li>

                        <li>

                            <a href="#">

                                <span class="label label-info"><i class="icon-bullhorn"></i></span>

                                Application error.

                                <span class="time">40 mins</span>

                            </a>

                        </li>

                        <li>

                            <a href="#">

                                <span class="label label-important"><i class="icon-bolt"></i></span>

                                Database overloaded 68%.

                                <span class="time">2 hrs</span>

                            </a>

                        </li>

                        <li>

                            <a href="#">

                                <span class="label label-important"><i class="icon-bolt"></i></span>

                                2 user IP blocked.

                                <span class="time">5 hrs</span>

                            </a>

                        </li>

                        <li class="external">

                            <a href="#">See all notifications <i class="m-icon-swapright"></i></a>

                        </li>

                    </ul>

                </li>

                <!-- END NOTIFICATION DROPDOWN -->

                <!-- BEGIN INBOX DROPDOWN -->

                <li class="dropdown" id="header_inbox_bar">

                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">

                        <i class="icon-envelope"></i>

                        <span class="badge">5</span>

                    </a>

                    <ul class="dropdown-menu extended inbox">

                        <li>

                            <p>You have 12 new messages</p>

                        </li>

                        <li>

                            <a href="inbox.html?a=view">

                                <span class="photo"><img src="media/image/avatar2.jpg" alt=""></span>

								<span class="subject">

								<span class="from">Lisa Wong</span>

								<span class="time">Just Now</span>

								</span>

								<span class="message">

								Vivamus sed auctor nibh congue nibh. auctor nibh

								auctor nibh...

								</span>

                            </a>

                        </li>

                        <li>

                            <a href="inbox.html?a=view">

                                <span class="photo"><img src="media/image/avatar3.jpg" alt=""></span>

								<span class="subject">

								<span class="from">Richard Doe</span>

								<span class="time">16 mins</span>

								</span>

								<span class="message">

								Vivamus sed congue nibh auctor nibh congue nibh. auctor nibh

								auctor nibh...

								</span>

                            </a>

                        </li>

                        <li>

                            <a href="inbox.html?a=view">

                                <span class="photo"><img src="media/image/avatar1.jpg" alt=""></span>

								<span class="subject">

								<span class="from">Bob Nilson</span>

								<span class="time">2 hrs</span>

								</span>

								<span class="message">

								Vivamus sed nibh auctor nibh congue nibh. auctor nibh

								auctor nibh...

								</span>

                            </a>

                        </li>

                        <li class="external">

                            <a href="inbox.html">See all messages <i class="m-icon-swapright"></i></a>

                        </li>

                    </ul>

                </li>

                <!-- END INBOX DROPDOWN -->

                <!-- BEGIN TODO DROPDOWN -->

                <li class="dropdown" id="header_task_bar">

                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">

                        <i class="icon-tasks"></i>

                        <span class="badge">5</span>

                    </a>

                    <ul class="dropdown-menu extended tasks">

                        <li>

                            <p>You have 12 pending tasks</p>

                        </li>

                        <li>

                            <a href="#">

								<span class="task">

								<span class="desc">New release v1.2</span>

								<span class="percent">30%</span>

								</span>

								<span class="progress progress-success ">

								<span style="width: 30%;" class="bar"></span>

								</span>

                            </a>

                        </li>

                        <li>

                            <a href="#">

								<span class="task">

								<span class="desc">Application deployment</span>

								<span class="percent">65%</span>

								</span>

								<span class="progress progress-danger progress-striped active">

								<span style="width: 65%;" class="bar"></span>

								</span>

                            </a>

                        </li>

                        <li>

                            <a href="#">

								<span class="task">

								<span class="desc">Mobile app release</span>

								<span class="percent">98%</span>

								</span>

								<span class="progress progress-success">

								<span style="width: 98%;" class="bar"></span>

								</span>

                            </a>

                        </li>

                        <li>

                            <a href="#">

								<span class="task">

								<span class="desc">Database migration</span>

								<span class="percent">10%</span>

								</span>

								<span class="progress progress-warning progress-striped">

								<span style="width: 10%;" class="bar"></span>

								</span>

                            </a>

                        </li>

                        <li>

                            <a href="#">

								<span class="task">

								<span class="desc">Web server upgrade</span>

								<span class="percent">58%</span>

								</span>

								<span class="progress progress-info">

								<span style="width: 58%;" class="bar"></span>

								</span>

                            </a>

                        </li>

                        <li>

                            <a href="#">

								<span class="task">

								<span class="desc">Mobile development</span>

								<span class="percent">85%</span>

								</span>

								<span class="progress progress-success">

								<span style="width: 85%;" class="bar"></span>

								</span>

                            </a>

                        </li>

                        <li class="external">

                            <a href="#">See all tasks <i class="m-icon-swapright"></i></a>

                        </li>

                    </ul>

                </li>

                <!-- END TODO DROPDOWN -->

                <!-- BEGIN USER LOGIN DROPDOWN -->

                <li class="dropdown user">

                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">

                        <img alt="" src="media/image/avatar1_small.jpg">

                        <span class="username">Bob Nilson</span>

                        <i class="icon-angle-down"></i>

                    </a>

                    <ul class="dropdown-menu">

                        <li><a href="extra_profile.html"><i class="icon-user"></i> My Profile</a></li>

                        <li><a href="page_calendar.html"><i class="icon-calendar"></i> My Calendar</a></li>

                        <li><a href="inbox.html"><i class="icon-envelope"></i> My Inbox(3)</a></li>

                        <li><a href="#"><i class="icon-tasks"></i> My Tasks</a></li>

                        <li class="divider"></li>

                        <li><a href="extra_lock.html"><i class="icon-lock"></i> Lock Screen</a></li>

                        <li><a href="login.html"><i class="icon-key"></i> Log Out</a></li>

                    </ul>

                </li>

                <!-- END USER LOGIN DROPDOWN -->

            </ul>

            <!-- END TOP NAVIGATION MENU -->

        </div>

    </div>

    <!-- END TOP NAVIGATION BAR -->

</div>
<!-- END HEADER -->
<!-- BEGIN CONTAINER -->
<div class="page-container">
    <!-- BEGIN PAGE -->
    <div class="page-content">
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span12">
                </div>
            </div>
            <!--开始内容-->
            <div class="row-fluid">
                <div class="portlet box red">

                    <div class="portlet-title">

                        <div class="caption"><i class="icon-globe"></i>月排班表
                            <!--<button class="btn blue">上一月 <i class="m-icon-swapleft"></i></button>-->
                            <!--<button class="btn green">当前月 <i class="icon-home"></i></button>-->
                            <!--<button class="btn purple">下一月 <i class="m-icon-swapright m-icon-white"></i></button>-->
                            <!--<div class="controls">-->
                            <select class="yearSelect" id="year">
                                <option value="2016">2016年</option>
                                <option value="2015">2015年</option>
                                <option value="2014">2014年</option>
                            </select>
                            <select class="yearSelect" id="month">
                                <option value="0">1月</option>
                                <option value="1">2月</option>
                                <option value="2">3月</option>
                                <option value="3">4月</option>
                                <option value="4">5月</option>
                                <option value="5">6月</option>
                                <option value="6" selected="selected">7月</option>
                                <option value="7">8月</option>
                                <option value="8">9月</option>
                                <option value="9">10月</option>
                                <option value="10">11月</option>
                                <option value="11">12月</option>
                            </select>
                            <button class="btn blue" id="goSearch">确定</button>
                            <!--</div>-->
                        </div>

                        <div class="tools">


                            <a href="javascript:;" class="reload"></a>

                            <a href="javascript:;" class="remove"></a>

                        </div>
                    </div>
                    <div class="portlet-body">
                        <table class="table table-striped table-bordered table-hover table-full-width"
                               id="monthScheduleTable">
                            <thead>
                            <tr>
                                <th>日期</th>
                                <th>时间段</th>
                                <th>线路</th>
                                <th>司机信息</th>
                                <th>车辆信息</th>
                                <th>出勤情况</th>
                            </tr>
                            </thead>
                            <tbody id="tableBody">

                            </tbody>
                        </table>
                    </div>
                    <div id="modal_remove" class="modal hide fade" tabindex="-1" data-backdrop="static"
                         data-keyboard="false">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                            <h3>注意</h3>
                        </div>
                        <div class="modal-body">
                            <h5>此操作不可撤销，确定删除此用户?</h5>
                        </div>
                        <div class="modal-footer">
                            <button type="button" data-dismiss="modal" class="btn mini">取消</button>
                            <button type="button" data-dismiss="modal" class="btn red mini" id="remove">删除</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- END PAGE CONTAINER-->

</div>
<!-- END PAGE -->
<!-- END CONTAINER -->

<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
<!-- BEGIN CORE PLUGINS -->

<script src="media/js/jquery-1.10.1.min.js" type="text/javascript"></script>
<script src="media/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
<!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
<script src="media/js/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>
<script src="media/js/bootstrap.min.js" type="text/javascript"></script>
<!--[if lt IE 9]>
<script src="media/js/excanvas.min.js"></script>
<script src="media/js/respond.min.js"></script>
<![endif]-->
<script src="media/js/calendar/date.js"></script>
<script type="text/javascript" src="media/js/select2.min.js"></script>
<script type="text/javascript" src="media/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="media/js/DT_bootstrap.js"></script>
<script src="media/js/jquery.blockui.min.js" type="text/javascript"></script>
<script src="media/js/monthSchedule.js"></script>
<script src="media/js/app.js"></script>

<script type='text/javascript'>
    var ip = 'http://192.168.1.7:3000';
    var totalDays;
    var extralData;
    $(document).ready(function () {
        getData();
        App.init();
        TableAdvanced.init(extralData);
    });

    function loadTable(data) {
        var scheduleData = formatData(data);
        var html = '';
        for (var i = 1; i < totalDays + 1; i++) {
            html += '<tr id="' + (i - 1) + '">';
            //日期列
            html += '<td>' + i + '</td>';
            var length = scheduleData[i - 1].driverRoute.length;
            //有排班信息
            if (length > 0) {
                var firstRoute = scheduleData[i - 1].driverRoute[0];
                var timeSlot = formatTime(firstRoute.route.time);
                //信息列
                html += ' <td> ' + timeSlot + '</td> '
                        + '<td>' + firstRoute.route.name + '</td> '
                        + '<td>' + firstRoute.driver.name + '</td>'
                        + '<td >' + firstRoute.bus.plate_number + '</td>'
                        + '<td style="vertical-align: middle;text-align: center"><a href="javascript:;" class="btn red mini delete"><i class="icon-trash"></i> 删除</a></td> '
                        + '</tr>';
                //还有未显示的数据
                if (length > 1) {
                    extralData.push(scheduleData[i - 1]);
                }
            } else {
                html += ' <td> 无排班信息</td> '
                        + ' <td>&nbsp;</td> '
                        + '<td>&nbsp;</td>'
                        + '<td > &nbsp;</td>'
                        + '<td style="vertical-align: middle;text-align: center"><a href="javascript:;" class="btn red mini delete"><i class="icon-trash"></i> 删除</a></td> ' +
                        '</tr>';
            }
        }
        $("#tableBody").html(html);
    }
    function getData() {
        var year = $("#year").val();
        var month = $("#month").val();
        totalDays = Date.getDaysInMonth(year, month);
        extralData = new Array();
        var startDate = new Date(year, month, 1);
        var endDate = new Date(year, month, totalDays);
        postData = JSON.stringify({startdate: startDate, enddate: endDate});
        $.ajax({
            url: ip + '/users/getRouteDriverByDate',
            type: 'POST',
            async: false,
            data: postData,
            dataType: 'json',
            contentType: "application/json",
            success: function (schedule) {
                if (schedule != null) {
                    loadTable(schedule);

                }
                else {
                    alert('链接失败');
                }
            },
            error: function (xhr, type, exception) {
                alert(type);
            }
        });
    }
    function formatData(schedule) {
        var array = new Array();
        for (var i = 1; i < totalDays + 1; i++) {
            var data = {day: i, driverRoute: []};
            array.push(data);
            for (var j in schedule) {
                var scheduleDate = new Date(schedule[j].date);
                if (scheduleDate.getDate() == i) {
                    array[i - 1].driverRoute.push(schedule[j]);
                }
            }
        }
        return array;
    }
    function formatTime(index) {
        switch (index) {
            case 1:
                return '00:00-02:00';
            case 2:
                return '02:00-04:00';
            case 3:
                return '04:00-06:00';
            case 4:
                return '06:00-08:00';
            case 5:
                return '08:00-10:00';
            case 6:
                return '10:00-12:00';
            case 7:
                return '12:00-14:00';
            case 8:
                return '14:00-16:00';
            case 9:
                return '16:00-18:00';
            case 10:
                return '18:00-20:00';
            case 11:
                return '20:00-22:00';
            case 12:
                return '22:00-24:00';
            default:
                return '10:00-12:00';
        }
    }
    $("#goSearch").click(function () {
        getData();
        load(extralData);

    })
</script>
</body>
</html>
